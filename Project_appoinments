import javax.swing.*;
import java.awt.*;
import java.sql.*;
import java.awt.event.*;

public class ScheduleAppointmentPage extends JFrame {
    private JComboBox<String> donationTypeBox, districtBox, centerBox, timeBox;
    private JComboBox<String> dayBox, monthBox, yearBox;
    private JButton scheduleButton;

    private String[] donationTypes = {"Blood", "Platelet"};
    private String[] districts = {"Select District", "Thiruvananthapuram", "Kollam", "Pathanamthitta", "Alappuzha", "Kottayam"};
    private String[][] centers = {
        {"Select Center"},
        {"Govt Medical College", "District Hospital", "Red Cross Blood Bank"},
        {"Govt Hospital Kollam", "Metro Hospital"},
        {"Pathanamthitta Medical Center", "City Hospital"},
        {"Alappuzha Blood Bank", "General Hospital"},
        {"Kottayam Medical Center", "Community Hospital"}
    };
    private String[] times = {"09:00 AM", "10:00 AM", "11:00 AM", "12:00 PM", "02:00 PM", "03:00 PM"};
    public ScheduleAppointmentPage() {
        setTitle("Schedule New Appointment");
        setSize(400, 500);
        setLocationRelativeTo(null);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(null);

        JLabel typeLabel = new JLabel("Donation Type:");
        typeLabel.setBounds(30, 25, 120, 25);
        add(typeLabel);
        donationTypeBox = new JComboBox<>(donationTypes);
        donationTypeBox.setBounds(180, 25, 180, 25);
        add(donationTypeBox);

        JLabel dateLabel = new JLabel("Date:");
        dateLabel.setBounds(30, 65, 120, 25);
        add(dateLabel);

        String[] days = new String[32];
        days[0] = "DD";
        for (int i = 1; i <= 31; i++) days[i] = String.valueOf(i);
        dayBox = new JComboBox<>(days);
        dayBox.setBounds(180, 65, 50, 25);
        add(dayBox);

        String[] months = {"MM", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"};
        monthBox = new JComboBox<>(months);
        monthBox.setBounds(240, 65, 60, 25);
        add(monthBox);

        String[] years = new String[3];
        years[0] = "YYYY";
        years[1] = "2025";
        years[2] = "2026";
        yearBox = new JComboBox<>(years);
        yearBox.setBounds(310, 65, 60, 25);
        add(yearBox);

        JLabel districtLabel = new JLabel("District:");
        districtLabel.setBounds(30, 105, 120, 25);
        add(districtLabel);
        districtBox = new JComboBox<>(districts);
        districtBox.setBounds(180, 105, 180, 25);
        add(districtBox);

        JLabel centerLabel = new JLabel("Center:");
        centerLabel.setBounds(30, 145, 120, 25);
        add(centerLabel);
        centerBox = new JComboBox<>(centers[0]);
        centerBox.setBounds(180, 145, 180, 25);
        add(centerBox);

        districtBox.addActionListener(e -> centerBox.setModel(new DefaultComboBoxModel<>(centers[Math.min(districtBox.getSelectedIndex(), centers.length - 1)])));

        JLabel timeLabel = new JLabel("Time Slot:");
        timeLabel.setBounds(30, 185, 120, 25);
        add(timeLabel);
        timeBox = new JComboBox<>(times);
        timeBox.setBounds(180, 185, 180, 25);
        add(timeBox);

        scheduleButton = new JButton("Schedule Appointment");
        scheduleButton.setBackground(Color.RED);
        scheduleButton.setForeground(Color.WHITE);
        scheduleButton.setFont(new Font("Arial", Font.BOLD, 15));
        scheduleButton.setBounds(90, 240, 220, 40);
        add(scheduleButton);

        scheduleButton.addActionListener(e -> saveAppointment());

    }

    private void saveAppointment() {
        String donationType = (String) donationTypeBox.getSelectedItem();
        String day = (String) dayBox.getSelectedItem();
        String month = (String) monthBox.getSelectedItem();
        String year = (String) yearBox.getSelectedItem();
        String district = (String) districtBox.getSelectedItem();
        String center = (String) centerBox.getSelectedItem();
        String time = (String) timeBox.getSelectedItem();

        // Simple validation
        if (dayBox.getSelectedIndex() == 0 || monthBox.getSelectedIndex() == 0 || yearBox.getSelectedIndex() == 0 ||
            districtBox.getSelectedIndex() == 0 || centerBox.getSelectedIndex() == 0 ) {
            JOptionPane.showMessageDialog(this, "Please fill all the fields correctly.");
            return;
        }

        String appointmentDate = year + "-" + month + "-" + day;

        try {
            Connection con = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/blood_donor_db", "root", "yourpassword");
            String sql = "INSERT INTO appointments (donation_type, date, district, center, time_slot) VALUES (?, ?, ?, ?, ?)";
            PreparedStatement ps = con.prepareStatement(sql);
            ps.setString(1, donationType);
            ps.setString(2, appointmentDate);
            ps.setString(3, district);
            ps.setString(4, center);
            ps.setString(5, time);
            ps.executeUpdate();
            con.close();

            JOptionPane.showMessageDialog(this, "Appointment Scheduled Successfully!");
            dispose(); // Close the window on success
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(this, "Database Error: " + ex.getMessage());
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> new ScheduleAppointmentPage().setVisible(true));
    }
}
